<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lelefon Gaming Store</title>
  <link rel="icon" type="image/png" href="images/lelefonlogo2.png?v=2" sizes="192x192">
  <link rel="stylesheet" href="homestyle.css"/>

  <style>
    :root{
      --bw-black:#111827;
      --bw-white:#ffffff;
      --bw-gray:#e5e7eb;
    }
    .container { max-width: 1100px; margin: 0 auto; padding: 0 16px; }

    /* ---------------- Banner Carousel ---------------- */
    .hero-wrap{ margin-top: 12px; }
    .banner {
      position: relative;
      width: 100%;
      aspect-ratio: 16/6;
      border-radius: 14px;
      overflow: hidden;
      background: #0f172a;
      box-shadow: 0 10px 24px rgba(0,0,0,.18);
    }
    .banner img{
      width:100%; height:100%; object-fit: cover; display:block;
      transition: opacity .35s ease;
    }
    .banner-nav{
      position:absolute; inset:0; display:flex; align-items:center; justify-content:space-between; pointer-events:none;
    }
    .banner-btn{
      pointer-events:auto;
      width:40px;height:40px;border-radius:999px;border:none;cursor:pointer;
      color:#fff;background:rgba(0,0,0,.45);
      display:grid;place-items:center;font-size:18px;
      margin:0 8px; backdrop-filter: blur(2px);
    }
    .banner-dots{
      position:absolute; bottom:10px; left:50%; transform:translateX(-50%);
      display:flex; gap:8px; background:rgba(0,0,0,.28); padding:6px 10px; border-radius:999px;
    }
    .banner-dot{
      width:8px;height:8px;border-radius:999px;background:#d1d5db; opacity:.7; cursor:pointer;
    }
    .banner-dot.active{ background:#fff; opacity:1; }

    /* ---------------- Game Grid ---------------- */
    .game-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }
    @media (min-width: 600px) {.game-grid { grid-template-columns: repeat(3, 1fr); }}
    @media (min-width: 900px) {.game-grid { grid-template-columns: repeat(5, 1fr); }}

    .game-card { cursor: pointer; }
    .game-thumb {
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      aspect-ratio: 1 / 1;
      background: #f4f4f5;
      box-shadow: 0 6px 18px rgba(0,0,0,.06);
      transition: transform .18s ease, box-shadow .18s ease;
    }
    .game-card:hover .game-thumb { transform: translateY(-3px); box-shadow: 0 10px 24px rgba(0,0,0,.12); }
    .game-thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .game-name { margin-top: 10px; text-align: center; font-weight: 800; color: #111827; }

    /* ---------------- Search & Category ---------------- */
    .controls { margin: 18px 0; }
    .searchbar {
      width: 100%;
      display:flex; align-items:center; gap:10px;
      background:var(--bw-white);
      border:1px solid var(--bw-gray);
      border-radius:12px;
      padding:10px 14px;
      color:var(--bw-black);
      box-shadow: 0 1px 2px rgba(0,0,0,.04);
    }
    .searchbar input {
      flex:1; background:transparent; border:none; outline:none;
      color:var(--bw-black); font-weight:600;
    }
    .searchbar input::placeholder { color:#9ca3af; }
    .search-btn {
      border:none; background:var(--bw-black); color:var(--bw-white);
      width:36px; height:36px; border-radius:10px; font-size:16px; cursor:pointer;
    }

    .category-row {
      margin-top:14px; display:flex; gap:8px; flex-wrap:wrap; justify-content:center;
    }
    .filter-btn {
      border:1px solid var(--bw-gray); background:#fff; color:var(--bw-black);
      border-radius:999px; padding:6px 12px; cursor:pointer; font-weight:700;
    }
    .filter-btn.active { background:var(--bw-black); color:#fff; border-color:var(--bw-black); }

    /* ---------------- Quick Links ---------------- */
    .quicklinks {
      margin: 22px 0 12px;
      display:grid; grid-template-columns: repeat(6, 1fr); gap:12px;
    }
    .ql-card{
      text-align:center; cursor:pointer; text-decoration:none; color:inherit;
    }
    .ql-icon{
      width:60px;height:60px;border-radius:16px; margin:0 auto 8px;
      display:grid;place-items:center; font-weight:900; color:#fff;
      background: linear-gradient(135deg,#4f46e5,#0ea5e9);
      box-shadow: 0 6px 16px rgba(0,0,0,.12);
    }
    .ql-name{ font-size:.92rem; font-weight:800; }

    /* ---------------- Payment Ticker ---------------- */
    .pay-wrap{ margin: 24px 0; border:1px solid var(--bw-gray); border-radius:12px; overflow:hidden; background:#fff; }
    .pay-title{ padding:10px 12px; font-weight:900; border-bottom:1px solid var(--bw-gray); }
    .pay-ticker{
      position:relative; overflow:hidden; padding:10px 0; background:#fff;
    }
    .pay-line{
      display:flex; align-items:center; gap:28px;
      animation: marquee 18s linear infinite;
      will-change: transform;
    }
    .pay-logo{
      min-width:120px; height:40px; border-radius:8px; display:grid; place-items:center;
      background:#f3f4f6; color:#111827; font-weight:900; border:1px solid #e5e7eb;
      padding: 0 12px;
    }
    @keyframes marquee{
      0%{ transform: translateX(0); }
      100%{ transform: translateX(-50%); }
    }

    /* ---------------- Region Modal ---------------- */
    .modal.hidden { display:none; }
    .modal { position:fixed; inset:0; z-index:1000; }
    .modal-backdrop { position:absolute; inset:0; background:rgba(0,0,0,.45); backdrop-filter: blur(2px); animation: fadeIn .18s ease-out; }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }
    .modal-dialog {
      position:relative; background:#ffffff; color:#0f172a; width:min(1020px,92vw);
      margin: 40px auto; border-radius:20px; box-shadow:0 20px 60px rgba(0,0,0,.35); padding:26px; animation: pop .18s ease-out;
    }
    @keyframes pop { from{ transform: translateY(6px); opacity:.95 } to{ transform: translateY(0); opacity:1 }}
    .modal-header { display:flex; align-items:center; gap:12px; }
    .modal-header h3 { font-size:1.8rem; font-weight:900; letter-spacing:.2px; margin:0; }
    .modal-close {
      position:absolute; top:14px; right:14px; width:40px;height:40px;border-radius:12px;
      background:#f3f4f6; color:#111827; border:none; font-size:22px; cursor:pointer; transition: background .2s ease;
      box-shadow: inset 0 -1px 0 rgba(0,0,0,.05);
    }
    .modal-close:hover { background: #e5e7eb; }
    .pill-muted { font-size:.78rem; font-weight:800; letter-spacing:.3px; padding:6px 10px; border-radius:999px; background:#e5e7eb; color:#0f172a; }

    .region-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px; }
    .region-card { cursor: pointer; position: relative; border-radius: 8px; background: var(--bg-soft); border: 1px solid var(--border);
      color: var(--text); padding: 8px; text-align: center; transition: transform .2s, box-shadow .2s; max-width: 160px; margin: 0 auto; }
    .region-thumb { position: relative; border-radius: 8px; overflow: hidden; background: #f4f4f5; aspect-ratio: 1 / 1; width: 100%; height: 80px;
      box-shadow: 0 4px 12px rgba(0,0,0,.06); transition: transform .18s ease, box-shadow .18s ease; }
    .region-card:hover .region-thumb { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(0,0,0,.12); }
    .region-thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .region-name { margin-top: 8px; font-weight: 700; color: var(--text); font-size: 1rem; }
    .flag-badge { position: absolute; top: 6px; right: 6px; width: 22px; height: 22px; border-radius: 50%; background: #ffffff; color: #111827;
      display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 900; border: 1px solid rgba(0,0,0,.06);
      box-shadow: 0 2px 6px rgba(0,0,0,.08); user-select: none; }
    .chip { position: absolute; left: 8px; bottom: 8px; padding: 6px 12px; border-radius: 6px; font-size: .75rem; font-weight: 600; letter-spacing: .3px; color: #fff; box-shadow: 0 2px 6px rgba(0,0,0,.12); }
    .chip.uid { background: #16a34a; } .chip.code { background: #ea8a00; }

    .hero h2 { margin: 14px 0 6px; text-align:center; }
    .hero p { text-align:center; }

    /* ---------------- Footer / Disclaimer ---------------- */
    footer{ margin-top:28px; }
    .disclaimer{
      margin-top: 18px;
      font-size:.9rem; color:#4b5563; background:#f9fafb; border:1px solid #e5e7eb;
      padding:12px 14px; border-radius:10px;
    }
  </style>
</head>

<body>
<header class="navbar">
  <div class="navbar-inner">
    <div class="logo-container">
      <a href="/" class="logo-link">
        <img src="images/lelefonlogo.png" alt="Lelefon Logo" class="logo"/>
        <h1>Lelefon Gaming</h1>
      </a>
    </div>
    <nav class="right-area">
      <a href="/">Home</a>
      <a href="transaction.html">Transactions</a>
      <a href="profile.html">Profile</a>
      <span class="wallet-pill">LF Wallet: <span id="walletAmt">0.00</span> MYR</span>
      <a class="btn ghost" href="cart.html">Cart (<span id="cartCount">0</span>)</a>
      <span id="authArea"><a class="btn primary" href="login.html">Login</a></span>
    </nav>
  </div>
</header>

<main class="container">
  <!-- Banner -->
  <div class="hero-wrap">
    <div class="banner" id="bannerBox">
      <img id="bannerImg" src="images/banner1.jpg" alt="Promo banner">
      <div class="banner-nav">
        <button class="banner-btn" id="bannerPrev" aria-label="Previous">‚Äπ</button>
        <button class="banner-btn" id="bannerNext" aria-label="Next">‚Ä∫</button>
      </div>
      <div class="banner-dots" id="bannerDots"></div>
    </div>
  </div>

  <section class="hero">
    <h2>Top Up Your Favourite Games Instantly ‚ö°</h2>
    <p>Fast, Secure & Trusted by Gamers.</p>
  </section>

  <!-- Search + Category -->
  <section class="games-section" id="topup">
    <div class="controls">
      <div class="searchbar">
        <input id="searchBox" type="search" placeholder="Search for games" aria-label="Search for games">
        <button id="searchBtn" class="search-btn" title="Search" aria-label="Search">üîç</button>
      </div>
      <div class="category-row">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="direct">UID</button>
        <button class="filter-btn" data-filter="card">CODE</button>
      </div>
    </div>

    <!-- Quick Links Icons -->
    <div class="quicklinks" id="quickLinks"></div>

    <h3 style="text-align:center;margin:10px 0 12px;">Popular Games</h3>
    <div class="game-grid" id="gameGrid">
      <p class="muted">Loading games from database...</p>
    </div>

    <!-- Payment Methods Ticker -->
    <div class="pay-wrap">
      <div class="pay-title">Payment Methods</div>
      <div class="pay-ticker">
        <div class="pay-line" id="payLine"></div>
      </div>
    </div>
  </section>
</main>

<footer class="container">
  <p style="text-align:center">¬© 2025 Lelefon Gaming Store. All Rights Reserved.</p>
  <div class="disclaimer">
    <strong>Disclaimer:</strong> All product names, logos, and brands are property of their respective owners. 
    Lelefon Gaming is a reseller platform. Prices and availability are subject to change without notice. 
    By using this site you agree to our Terms of Service and Privacy Policy.
  </div>
</footer>

<!-- Region Modal -->
<div id="regionModal" class="modal hidden">
  <div class="modal-backdrop" onclick="closeModal()"></div>
  <div class="modal-dialog">
    <button class="modal-close" onclick="closeModal()">‚úï</button>
    <div class="modal-header">
      <h3>Select Server/Region</h3>
      <span id="modalGameChip" class="pill-muted"></span>
    </div>
    <div class="region-grid" id="regionGrid"></div>
  </div>
</div>

<script>
/* ---------------- Configurable assets ---------------- */
const BANNERS = [
  {src:'images/banner1.jpg', link:'#'},
  {src:'images/banner2.jpg', link:'#'},
  {src:'images/banner3.jpg', link:'#'},
  {src:'images/banner4.jpg', link:'#'},
  {src:'images/banner5.jpg', link:'#'},
  {src:'images/banner6.jpg', link:'#'},
];

const QUICK_LINKS = [
  {name:'MLBB',    color:'linear-gradient(135deg,#06b6d4,#3b82f6)', link:'https://m.mobilelegends.com/', icon:'ML'},
  {name:'Genshin', color:'linear-gradient(135deg,#22c55e,#84cc16)', link:'https://genshin.hoyoverse.com/', icon:'G'},
  {name:'PUBG',    color:'linear-gradient(135deg,#f97316,#f59e0b)', link:'https://www.pubgmobile.com/', icon:'P'},
  {name:'Valorant',color:'linear-gradient(135deg,#ef4444,#ec4899)', link:'https://playvalorant.com/', icon:'V'},
  {name:'Free Fire',color:'linear-gradient(135deg,#a855f7,#6366f1)', link:'https://ff.garena.com/', icon:'F'},
  {name:'Steam',   color:'linear-gradient(135deg,#0ea5e9,#2563eb)', link:'https://store.steampowered.com/', icon:'S'},
];

const PAYMENTS = [
  {label:'Touch ‚Äôn Go eWallet'},
  {label:'GrabPay'},
  {label:'Boost'},
  {label:'Maybank QRPay'},
  {label:'Visa/Mastercard'},
  {label:'7-Eleven'},
];

/* ---------------- Store / Existing Logic ---------------- */
const API_BASE_URL = 'https://api.lelefon-67.workers.dev/api';
const Store = { read:(k,d)=>{try{return JSON.parse(localStorage.getItem(k))??d}catch{return d}}, write:(k,v)=>localStorage.setItem(k,JSON.stringify(v)) };
const user = Store.read('lf_user');

let ALL_GAMES = [];
let ACTIVE_FILTER = 'all';
let SEARCH_QUERY = '';

async function refreshNavbar() {
  const cart = Store.read('lf_cart', []);
  document.getElementById('cartCount').textContent = cart.reduce((s, i) => s + (i.qty || 1), 0);
  if (user) {
    document.getElementById('authArea').innerHTML = `<span class="pill">Hi, ${user.email}</span>`;
    try {
      const r = await fetch(`${API_BASE_URL}/wallet?email=${encodeURIComponent(user.email)}`);
      const d = await r.json();
      document.getElementById('walletAmt').textContent = Number(d.balance||0).toFixed(2) + ' MYR';
    } catch { document.getElementById('walletAmt').textContent = 'Error'; }
  } else {
    document.getElementById('authArea').innerHTML = `<a class="btn primary" href="login.html">Login</a>`;
    document.getElementById('walletAmt').textContent = '0.00 MYR';
  }
}

function renderGames(list){
  const grid = document.getElementById('gameGrid');
  if (!list.length){
    grid.innerHTML = '<p class="muted">No games match your search.</p>';
    return;
  }
  grid.innerHTML = list.map(g => `
    <div class="game-card" data-category="${g.category}" onclick='handleGameClick(${JSON.stringify(g)})'>
      <div class="game-thumb">
        <img src="${g.image_url}" alt="${g.name}" onerror="this.src='images/lelefonlogo2.png'">
      </div>
      <div class="game-name">${g.name}</div>
    </div>`).join('');
}

function applyFilters(){
  const q = SEARCH_QUERY.trim().toLowerCase();
  const filtered = ALL_GAMES.filter(g => {
    const catOk = (ACTIVE_FILTER==='all') || (g.category === ACTIVE_FILTER);
    const textOk = q === '' || (g.name || '').toLowerCase().includes(q);
    return catOk && textOk;
  });
  renderGames(filtered);
}

async function loadGames() {
  const grid = document.getElementById('gameGrid');
  try {
    const res = await fetch(`${API_BASE_URL}/games`);
    ALL_GAMES = await res.json();
    if (!ALL_GAMES.length) {
      grid.innerHTML = '<p class="muted">No games added yet.</p>';
    } else {
      applyFilters();
    }
  } catch {
    grid.innerHTML = '<p class="muted">Failed to load games.</p>';
  }
}

function openModal(){ document.getElementById('regionModal').classList.remove('hidden'); }
function closeModal(){ document.getElementById('regionModal').classList.add('hidden'); }

async function handleGameClick(game) {
  const isCode = game.category === 'card';
  document.getElementById('modalGameChip').textContent = `${isCode ? 'CODE' : 'UID'} ${game.name}`;
  if (Number(game.regionable) === 1) {
    try {
      const r = await fetch(`${API_BASE_URL}/regions?gameId=${encodeURIComponent(game.id)}`);
      const regions = await r.json();
      renderRegionGrid(game, regions);
      openModal();
    } catch { alert('Could not fetch regions.'); }
  } else {
    navigateToProduct(game.id, game.name, null, game.uid_required, game.category);
  }
}

function renderRegionGrid(game, regions) {
  const grid = document.getElementById('regionGrid');
  const isCode = game.category === 'card';
  if (!regions.length) return grid.innerHTML = '<p class="muted">No regions yet.</p>';
  grid.innerHTML = regions.map(r => `
    <div class="region-card" onclick="navigateToProduct('${game.id}','${encodeURIComponent(game.name)}','${r.region_key}',${game.uid_required},'${game.category}')">
      <div class="region-thumb">
        <img src="${game.image_url}" alt="${game.name}">
        <div class="flag-badge">${r.flag || 'üåê'}</div>
        <div class="chip ${isCode ? 'code' : 'uid'}">${isCode ? 'CODE' : 'UID'}</div>
      </div>
      <div class="region-name">${game.name} (${r.name})</div>
    </div>`).join('');
}

function navigateToProduct(id,name,region,uid,cat){
  let url=`product.html?game=${encodeURIComponent(id)}&name=${encodeURIComponent(name)}&uid=${uid}&cat=${encodeURIComponent(cat)}`;
  if(region)url+=`&region=${encodeURIComponent(region)}`;
  location.href=url;
}

/* -------- Filter + Search Bindings -------- */
document.querySelectorAll('.filter-btn').forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    ACTIVE_FILTER = btn.dataset.filter || 'all';
    applyFilters();
  };
});

let searchTimer = null;
const searchInput = document.getElementById('searchBox');
const searchBtn   = document.getElementById('searchBtn');

function doSearch(){
  SEARCH_QUERY = searchInput.value || '';
  applyFilters();
}
searchInput.addEventListener('input', () => {
  clearTimeout(searchTimer);
  searchTimer = setTimeout(doSearch, 180);
});
searchInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); doSearch(); }});
searchBtn.addEventListener('click', doSearch);

/* ---------------- Banner Carousel Logic ---------------- */
let bannerIndex = 0;
const bannerImg = document.getElementById('bannerImg');
const bannerDots = document.getElementById('bannerDots');

function renderDots(){
  bannerDots.innerHTML = BANNERS.map((_,i)=>`<div class="banner-dot ${i===bannerIndex?'active':''}" data-i="${i}"></div>`).join('');
  bannerDots.querySelectorAll('.banner-dot').forEach(dot=>{
    dot.onclick=()=>{ bannerIndex=+dot.dataset.i; swapBanner(); };
  });
}
function swapBanner(){
  const {src,link} = BANNERS[bannerIndex];
  bannerImg.style.opacity = .2;
  setTimeout(()=>{
    bannerImg.src = src;
    bannerImg.parentElement.onclick = ()=> link ? (location.href = link) : null;
    bannerImg.style.opacity = 1;
    renderDots();
  }, 120);
}
document.getElementById('bannerPrev').onclick = ()=>{ bannerIndex = (bannerIndex - 1 + BANNERS.length) % BANNERS.length; swapBanner(); };
document.getElementById('bannerNext').onclick = ()=>{ bannerIndex = (bannerIndex + 1) % BANNERS.length; swapBanner(); };
let autoTimer = setInterval(()=>{ bannerIndex = (bannerIndex + 1) % BANNERS.length; swapBanner(); }, 4500);
document.getElementById('bannerBox').addEventListener('mouseenter', ()=>clearInterval(autoTimer));
document.getElementById('bannerBox').addEventListener('mouseleave', ()=>{ autoTimer = setInterval(()=>{ bannerIndex = (bannerIndex + 1) % BANNERS.length; swapBanner(); }, 4500); });

/* ---------------- Quick Links Render ---------------- */
function renderQuickLinks(){
  const box = document.getElementById('quickLinks');
  box.innerHTML = QUICK_LINKS.map(q=>`
    <a class="ql-card" href="${q.link}" target="_blank" rel="noopener">
      <div class="ql-icon" style="background:${q.color}">${q.icon}</div>
      <div class="ql-name">${q.name}</div>
    </a>
  `).join('');
}

/* ---------------- Payments Ticker Render ---------------- */
function renderPayments(){
  // We duplicate the list so the marquee can loop smoothly at 50%
  const line = document.getElementById('payLine');
  const all = [...PAYMENTS, ...PAYMENTS];
  line.innerHTML = all.map(p=>`<div class="pay-logo">${p.label}</div>`).join('');
}

/* ---------------- Boot ---------------- */
document.addEventListener('DOMContentLoaded',()=>{
  refreshNavbar();
  loadGames();
  renderDots();
  renderQuickLinks();
  renderPayments();
  swapBanner(); // initial
});
</script>
</body>
</html>
