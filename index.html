<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lelefon Gaming Store</title>
  <link rel="icon" type="image/png" href="images/lelefonlogo2.png?v=2" sizes="192x192">
  <link rel="stylesheet" href="homestyle.css"/>

  <style>
    /* ---------- Game Grid ---------- */
    .game-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }
    @media (min-width: 600px) {.game-grid { grid-template-columns: repeat(3, 1fr); }}
    @media (min-width: 900px) {.game-grid { grid-template-columns: repeat(5, 1fr); }}

    .game-card {
      cursor: pointer;
    }
    .game-thumb {
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      aspect-ratio: 1 / 1;
      background: #f4f4f5;
      box-shadow: 0 6px 18px rgba(0,0,0,.06);
      transition: transform .18s ease, box-shadow .18s ease;
    }
    .game-card:hover .game-thumb {
      transform: translateY(-3px);
      box-shadow: 0 10px 24px rgba(0,0,0,.12);
    }
    .game-thumb img {
      width: 100%; height: 100%; object-fit: cover; display: block;
    }
    .game-name {
      margin-top: 10px;
      text-align: center;
      font-weight: 800;
      color: #111827;
    }

    /* ---------- Filter ---------- */
    .filter-bar { display:flex; gap:8px; margin:10px 0 18px; }
    .filter-btn { border:1px solid var(--border); background:#fff; border-radius:20px; padding:6px 12px; cursor:pointer; font-weight:700; }
    .filter-btn.active { background:var(--brand); color:#fff; border-color:var(--brand); }

    /* ---------- Modal (Light) ---------- */
    .modal.hidden { display:none; }
    .modal { position:fixed; inset:0; z-index:1000; }
    .modal-backdrop {
      position:absolute; inset:0;
      background:rgba(0,0,0,.45);
      backdrop-filter: blur(2px);
      animation: fadeIn .18s ease-out;
    }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }

    .modal-dialog {
      position:relative;
      background:#ffffff;
      color:#0f172a;
      width:min(1020px,92vw);
      margin: 40px auto;
      border-radius:20px;
      box-shadow:0 20px 60px rgba(0,0,0,.35);
      padding:26px;
      animation: pop .18s ease-out;
    }
    @keyframes pop { from{ transform: translateY(6px); opacity:.95 } to{ transform: translateY(0); opacity:1 }}

    .modal-header { display:flex; align-items:center; gap:12px; }
    .modal-header h3 { font-size:1.8rem; font-weight:900; letter-spacing:.2px; margin:0; }

    .modal-close {
      position:absolute; top:14px; right:14px;
      width:40px;height:40px;border-radius:12px;
      background:#f3f4f6; color:#111827; border:none;
      font-size:22px; cursor:pointer; transition: background .2s ease;
      box-shadow: inset 0 -1px 0 rgba(0,0,0,.05);
    }
    .modal-close:hover { background: #e5e7eb; }

    .pill-muted {
      font-size:.78rem; font-weight:800; letter-spacing:.3px;
      padding:6px 10px; border-radius:999px; background:#e5e7eb; color:#0f172a;
    }

    .region-grid {
      display:grid; gap:22px; margin-top:18px;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    }

.region-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));  /* Decreased the minimum width */
  gap: 12px;  /* Reduced gap between cards */
}

.region-card {
  cursor: pointer;
  position: relative;
  border-radius: 8px;
  background: var(--bg-soft);
  border: 1px solid var(--border);
  color: var(--text);
  padding: 6px;
  cursor: pointer;
  text-align: center;
  transition: transform .2s, box-shadow .2s;
  max-width: 140px;
  margin: 0 auto;
}

.region-thumb {
  position: relative;
  border-radius: 8px;
  overflow: hidden;
  background: #f4f4f5;
  aspect-ratio: 1 / 1;
  width: 100%;
  height: 60px;  /* Smaller height */
  box-shadow: 0 4px 12px rgba(0,0,0,.06);
  transition: transform .18s ease, box-shadow .18s ease;
}

.region-card:hover .region-thumb {
  transform: translateY(-2px);
  box-shadow: 0 6px 18px rgba(0,0,0,.12);
}

.region-thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.region-name {
  margin-top: 4px;
  font-weight: 700;
  color: var(--text);
  font-size: 0.9rem;
}

.flag-badge {
  position: absolute;
  top: 4px;
  right: 4px;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: #ffffff;
  color: #111827;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  font-weight: 900;
  border: 1px solid rgba(0,0,0,.06);
  box-shadow: 0 2px 6px rgba(0,0,0,.08);
  user-select: none;
}

.chip {
  position: absolute;
  left: 6px;
  bottom: 6px;
  padding: 4px 6px;
  border-radius: 6px;
  font-size: .65rem;
  font-weight: 600;
  letter-spacing: .2px;
  color: #fff;
  box-shadow: 0 2px 6px rgba(0,0,0,.12);
}

.chip.uid {
  background: #16a34a;
}

.chip.code {
  background: #ea8a00;
}



    /* Page hero */
    .hero h2 { margin-bottom: 8px; }
  </style>
</head>

<body>
<header class="navbar">
  <div class="navbar-inner">
    <div class="logo-container">
      <a href="/" class="logo-link">
        <img src="images/lelefonlogo.png" alt="Lelefon Logo" class="logo"/>
        <h1>Lelefon Gaming</h1>
      </a>
    </div>
    <nav class="right-area">
      <a href="/">Home</a>
      <a href="transaction.html">Transactions</a>
      <a href="profile.html">Profile</a>
      <span class="wallet-pill">LF Wallet: <span id="walletAmt">0.00</span> MYR</span>
      <a class="btn ghost" href="cart.html">Cart (<span id="cartCount">0</span>)</a>
      <span id="authArea"><a class="btn primary" href="login.html">Login</a></span>
    </nav>
  </div>
</header>

<main class="container">
  <section class="hero">
    <h2>Top Up Your Favourite Games Instantly ‚ö°</h2>
    <p>Fast, Secure & Trusted by Gamers.</p>
  </section>

  <section class="games-section" id="topup">
    <h3>Popular Games</h3>

    <div class="filter-bar">
      <button class="filter-btn active" data-filter="all">All</button>
      <button class="filter-btn" data-filter="direct">UID</button>
      <button class="filter-btn" data-filter="card">CODE</button>
    </div>

    <div class="game-grid" id="gameGrid">
      <p class="muted">Loading games from database...</p>
    </div>
  </section>
</main>

<footer><p>¬© 2025 Lelefon Gaming Store. All Rights Reserved.</p></footer>

<!-- Region Modal -->
<div id="regionModal" class="modal hidden">
  <div class="modal-backdrop" onclick="closeModal()"></div>
  <div class="modal-dialog">
    <button class="modal-close" onclick="closeModal()">‚úï</button>
    <div class="modal-header">
      <h3>Select Server/Region</h3>
      <span id="modalGameChip" class="pill-muted"></span>
    </div>
    <div class="region-grid" id="regionGrid"></div>
  </div>
</div>

<script>
const API_BASE_URL = 'https://api.lelefon-67.workers.dev/api';
const Store = { read:(k,d)=>{try{return JSON.parse(localStorage.getItem(k))??d}catch{return d}}, write:(k,v)=>localStorage.setItem(k,JSON.stringify(v)) };
const user = Store.read('lf_user');

async function refreshNavbar() {
  const cart = Store.read('lf_cart', []);
  document.getElementById('cartCount').textContent = cart.reduce((s, i) => s + (i.qty || 1), 0);
  if (user) {
    document.getElementById('authArea').innerHTML = `<span class="pill">Hi, ${user.email}</span>`;
    try {
      const r = await fetch(`${API_BASE_URL}/wallet?email=${encodeURIComponent(user.email)}`);
      const d = await r.json();
      document.getElementById('walletAmt').textContent = Number(d.balance||0).toFixed(2) + ' MYR';
    } catch { document.getElementById('walletAmt').textContent = 'Error'; }
  } else {
    document.getElementById('authArea').innerHTML = `<a class="btn primary" href="login.html">Login</a>`;
    document.getElementById('walletAmt').textContent = '0.00 MYR';
  }
}

async function loadGames() {
  const grid = document.getElementById('gameGrid');
  try {
    const res = await fetch(`${API_BASE_URL}/games`);
    const games = await res.json();
    if (!games.length) return grid.innerHTML = '<p class="muted">No games added yet.</p>';
    grid.innerHTML = games.map(g => `
      <div class="game-card" data-category="${g.category}" onclick='handleGameClick(${JSON.stringify(g)})'>
        <div class="game-thumb">
          <img src="${g.image_url}" alt="${g.name}" onerror="this.src='images/lelefonlogo2.png'">
        </div>
        <div class="game-name">${g.name}</div>
      </div>`).join('');
  } catch {
    grid.innerHTML = '<p class="muted">Failed to load games.</p>';
  }
}

function openModal(){ document.getElementById('regionModal').classList.remove('hidden'); }
function closeModal(){ document.getElementById('regionModal').classList.add('hidden'); }

async function handleGameClick(game) {
  const isCode = game.category === 'card';
  document.getElementById('modalGameChip').textContent = `${isCode ? 'CODE' : 'UID'} ${game.name}`;
  if (Number(game.regionable) === 1) {
    try {
      const r = await fetch(`${API_BASE_URL}/regions?gameId=${encodeURIComponent(game.id)}`);
      const regions = await r.json();
      renderRegionGrid(game, regions);
      openModal();
    } catch { alert('Could not fetch regions.'); }
  } else {
    navigateToProduct(game.id, game.name, null, game.uid_required, game.category);
  }
}

function renderRegionGrid(game, regions) {
  const grid = document.getElementById('regionGrid');
  const isCode = game.category === 'card';
  if (!regions.length) return grid.innerHTML = '<p class="muted">No regions yet.</p>';
  grid.innerHTML = regions.map(r => `
    <div class="region-card" onclick="navigateToProduct('${game.id}','${encodeURIComponent(game.name)}','${r.region_key}',${game.uid_required},'${game.category}')">
      <div class="region-thumb">
        <img src="${game.image_url}" alt="${game.name}">
        <div class="flag-badge">${r.flag || 'üåê'}</div>
        <div class="chip ${isCode ? 'code' : 'uid'}">${isCode ? 'CODE' : 'UID'}</div>
      </div>
      <div class="region-name">${game.name} (${r.name})</div>
    </div>`).join('');
}

function navigateToProduct(id,name,region,uid,cat){
  let url=`product.html?game=${encodeURIComponent(id)}&name=${encodeURIComponent(name)}&uid=${uid}&cat=${encodeURIComponent(cat)}`;
  if(region)url+=`&region=${encodeURIComponent(region)}`;
  location.href=url;
}

document.querySelectorAll('.filter-btn').forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const f=btn.dataset.filter;
    document.querySelectorAll('.game-card').forEach(c=>{
      const cat=c.getAttribute('data-category');
      c.style.display=(f==='all'||cat===f)?'block':'none';
    });
  };
});

document.addEventListener('DOMContentLoaded',()=>{refreshNavbar();loadGames();});
</script>
</body>
</html>
